<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\Test;
use App\Models\TestQuestion;
use App\Models\TestQuestionOption;

class PersonalityTypeSeeder extends Seeder
{
    public function run(): void
    {

        $test = Test::where('code', 'personality-type')->first();

        if (!$test) {
            $this->command->error('Тест "Тип личности" не найден!');
            return;
        }


        $test->questions()->delete();
        $test->categories()->delete();

        $this->command->info("Удалены старые вопросы и категории для теста 'Тип личности'");

        $orderIndex = 1;


        $surveyQuestions = [
            'Город проживания',
            'В каком классе вы учитесь?',
            'В какой школе?',
            'Какие любимые предметы в школе?',
            'Какие предметы Вам не нравятся?',
            'Какие дополнительные занятия посещаете?',
            'Какие дополнительные занятия посещали в прошлом классе?',
            'Есть ли у Вас хобби? Если да, то какие?',
            'Какие профессии Вам нравятся?',
            'Какие профессии не интересуют?',
            'Выбрали ли уже профессию? Какую?',
            'Планируете дальнейшее обучение в колледже или вузе?',
            'Есть ли у Вас ограничения по здоровью в выборе профессии?'
        ];

        foreach ($surveyQuestions as $questionText) {
            TestQuestion::create([
                'test_id' => $test->id,
                'category_id' => null,
                'question_text' => $questionText,
                'question_type' => 'text',
                'order_index' => $orderIndex++,
                'is_required' => false,
            ]);
        }


        $questionPairs = [
            ['Ремонтировать бытовую технику', 'R', 'Лечить людей', 'S'],
            ['Читать научные книги или журналы', 'I', 'Оказывать влияние на других', 'E'],
            ['Делать наброски, рисовать красками', 'A', 'Заполнять анкеты', 'C'],
            ['Работать в лаборатории', 'I', 'Продавать что-либо', 'E'],
            ['Проектировать мебель', 'A', 'Вести деловую переписку', 'C'],
            ['Изучать стратегии делового успеха', 'E', 'Работать над научным проектом', 'I'],
            ['Ухаживать за животными', 'R', 'Заботиться о детях', 'S'],
            ['Заниматься дизайном', 'A', 'В бухгалтерском деле выполнять необходимые расчёты', 'C'],
            ['Помогать другим решать их личные проблемы', 'S', 'Изготавливать изделия из дерева', 'R'],
            ['Организовать собственное дело', 'E', 'Работать с химическими реактивами', 'I'],
            ['Изучать научные теории', 'I', 'Быстро ориентироваться и принимать решения', 'E'],
            ['Вести архивы, работать с каталогами', 'C', 'Заниматься компьютерной графикой', 'A'],
            ['Работать с металлообрабатывающими инструментами', 'R', 'Заниматься с трудными подростками', 'S'],
            ['Играть в ансамбле, эстрадном или симфоническом оркестре', 'A', 'Работать с офисной техникой', 'C'],
            ['Работать с правонарушителями', 'S', 'Работать охотоведом или рыболовом', 'R'],
            ['Проводить научные эксперименты', 'I', 'Организовывать рекламные акции', 'E'],
            ['Редактировать и исправлять ошибки в текстах и документах', 'C', 'Писать рассказы или пьесы', 'A'],
            ['Руководить группой для достижения определённой цели', 'E', 'Применять математику при решении практических задач', 'I'],
            ['Составлять чертежи', 'R', 'Обучать, преподавать, воспитывать', 'S'],
            ['Изучать физику', 'I', 'Быть членом правления какой-либо организации', 'E'],
            ['Брать уроки по искусству', 'A', 'Вести точный учёт доходов и расходов', 'C'],
            ['Изучать химию', 'I', 'Вести деловые переговоры', 'E'],
            ['Вести учёт снабжения или продукции', 'C', 'Сочинять или аранжировать музыку', 'A'],
            ['Ремонтировать квартиру', 'R', 'Изучать взаимоотношения людей', 'S'],
            ['Управлять транспортным средством', 'R', 'Проводить экскурсии', 'S'],
            ['Пройти курс экономики', 'C', 'Конструировать одежду', 'A'],
            ['Консультировать людей по различным вопросам', 'S', 'Работать с военной техникой', 'R']
        ];

        foreach ($questionPairs as $index => $pair) {
            $question = TestQuestion::create([
                'test_id' => $test->id,
                'category_id' => null,
                'question_text' => 'Выберите, что вам больше нравится:',
                'question_type' => 'radio',
                'order_index' => $orderIndex++,
                'is_required' => true,
            ]);


            TestQuestionOption::create([
                'question_id' => $question->id,
                'option_text' => $pair[0],
                'option_value' => $pair[1], // Буква типа для подсчета
                'weight' => 1,
                'order_index' => 1,
            ]);

            TestQuestionOption::create([
                'question_id' => $question->id,
                'option_text' => $pair[2],
                'option_value' => $pair[3], // Буква типа для подсчета
                'weight' => 1,
                'order_index' => 2,
            ]);
        }

        $this->command->info("Добавлено " . (count($surveyQuestions) + count($questionPairs)) . " вопросов для теста 'Тип личности':");
        $this->command->info("- " . count($surveyQuestions) . " анкетных вопросов");
        $this->command->info("- " . count($questionPairs) . " пар профессий");
    }
}
