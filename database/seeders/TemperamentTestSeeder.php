<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use Illuminate\Support\Facades\DB;
use App\Models\Test;
use App\Models\QuestionCategory;
use App\Models\TestQuestion;
use App\Models\TestQuestionOption;

class TemperamentTestSeeder extends Seeder
{
    public function run(): void
    {

        $oldTest = Test::where('code', 'temperament')->first();
        if ($oldTest) {
            $this->command->info("Удаляю старый тест: {$oldTest->title}");
            $oldTest->delete();
        }


        $test = Test::create([
            'code' => 'temperament',
            'title' => 'Темперамент',
            'description' => 'Определение типа темперамента: холерик, сангвиник, флегматик, меланхолик. Тест поможет выявить особенности вашего поведения и реакций.',
            'status' => 'active',
        ]);


        $phlegmaticQuestions = [
            'Спокойны и хладнокровны',
            'Последовательны и обстоятельны в делах',
            'Осторожны и рассудительны',
            'Умеете ждать',
            'Молчаливы и не любите зря болтать',
            'Обладаете спокойной, равномерной речью, с остановками, без резко выраженных эмоций, жестикуляции и мимики',
            'Сдержанны и терпеливы',
            'Доводите начатое дело до конца',
            'Не растрачиваете попусту сил',
            'Строго придерживаетесь выработанного распорядка в жизни, системы в работе',
            'Легко сдерживаете порывы',
            'Маловосприимчивы к одобрению и порицанию',
            'Незлобивы, проявляете снисходительное отношение к колкостям в свой адрес',
            'Постоянны в своих интересах и отношениях',
            'Медленно включаетесь в работу и переключаетесь с одного дела на другое',
            'Ровны в отношениях со всеми',
            'Любите аккуратность и порядок во всем',
            'С трудом приспосабливаетесь к новой обстановке',
            'Обладаете выдержкой',
            'Постепенно сходитесь с новыми людьми',
        ];


        $melancholicQuestions = [
            'Стеснительны и застенчивы',
            'Теряетесь в новой обстановке',
            'Затрудняетесь установить контакт с новыми людьми',
            'Не верите в свои силы',
            'Легко переносите одиночество',
            'Чувствуете подавленность и растерянность при неудачах',
            'Склонны уходить в себя',
            'Быстро утомляетесь',
            'Обладаете тихой речью, иногда снижающейся до шепота',
            'Невольно приспосабливаетесь к характеру собеседника',
            'Впечатлительны до слезливости',
            'Чрезвычайно восприимчивы к одобрению и порицанию',
            'Предъявляете высокие требования к себе и окружающим',
            'Склонны к подозрительности, мнительности',
            'Болезненно чувствительны и легко ранимы',
            'Чрезвычайно обидчивы',
            'Скрытны и необщительны, не делитесь ни с кем своими мыслями',
            'Малоактивны и робки',
            'Безропотно покорны',
            'Стремитесь вызвать сочувствие и помощь у окружающих',
        ];


        $cholericQuestions = [
            'Неусидчивы, суетливы',
            'Невыдержанны, вспыльчивы',
            'Нетерпеливы',
            'Резки и прямолинейны в отношениях с людьми',
            'Решительны и инициативны',
            'Упрямы',
            'Находчивы в споре',
            'Работаете рывками',
            'Склонны к риску',
            'Незлопамятны и необидчивы',
            'Обладаете быстрой, страстной, со сбивчивыми интонациями речью',
            'Неуравновешенны и склонны к горячности',
            'Нетерпимы к недостаткам',
            'Агрессивный забияка',
            'Обладаете выразительной мимикой',
            'Способны быстро действовать и решать',
            'Неустанно стремитесь к новому',
            'Обладаете резкими, порывистыми движениями',
            'Настойчивы в достижении поставленной цели',
            'Склонны к резким сменам настроения',
        ];


        $sanguineQuestions = [
            'Веселы и жизнерадостны',
            'Энергичны и деловиты',
            'Часто не доводите начатое дело до конца',
            'Склонны переоценивать себя',
            'Способны быстро схватывать новое',
            'Неустойчивы в интересах и склонностях',
            'Легко переживаете неудачи и неприятности',
            'Легко приспосабливаетесь к различным обстоятельствам',
            'С увлечением беретесь за любое новое дело',
            'Быстро остываете, если дело перестает вас интересовать',
            'Быстро включаетесь в новую работу и быстро переключаетесь с одной работы на другую',
            'Тяготитесь однообразием, будничной, кропотливой работой',
            'Общительны и отзывчивы, не чувствуете скованности с новыми людьми',
            'Выносливы и работоспособны',
            'Обладаете быстрой, громкой, отчетливой речью, сопровождающейся живыми жестами, выразительной мимикой',
            'Сохраняете самообладание в неожиданной, сложной обстановке',
            'Обладаете всегда бодрым настроением',
            'Быстро засыпаете и пробуждаетесь',
            'Часто не собранны, проявляете поспешность в решениях',
            'Склонны иногда скользить по поверхности, отвлекаться',
        ];


        $allQuestions = [];

        foreach ($phlegmaticQuestions as $question) {
            $allQuestions[] = ['text' => $question, 'type' => 'флегматик'];
        }

        foreach ($melancholicQuestions as $question) {
            $allQuestions[] = ['text' => $question, 'type' => 'меланхолик'];
        }

        foreach ($cholericQuestions as $question) {
            $allQuestions[] = ['text' => $question, 'type' => 'холерик'];
        }

        foreach ($sanguineQuestions as $question) {
            $allQuestions[] = ['text' => $question, 'type' => 'сангвиник'];
        }


        shuffle($allQuestions);

        $questionOrder = 1;


        foreach ($allQuestions as $questionData) {
            $question = TestQuestion::create([
                'test_id' => $test->id,
                'category_id' => null, // БЕЗ категорий!
                'question_text' => $questionData['text'],
                'question_type' => 'radio',
                'order_index' => $questionOrder++,
                'is_required' => true,
            ]);


            TestQuestionOption::create([
                'question_id' => $question->id,
                'option_text' => 'Да',
                'option_value' => $questionData['type'],
                'weight' => 1,
                'order_index' => 1,
            ]);

            TestQuestionOption::create([
                'question_id' => $question->id,
                'option_text' => 'Нет',
                'option_value' => 'no',
                'weight' => 0,
                'order_index' => 2,
            ]);
        }

        $this->command->info("Тест на темперамент создан! Добавлено " . ($questionOrder - 1) . " вопросов в случайном порядке.");
    }
}
